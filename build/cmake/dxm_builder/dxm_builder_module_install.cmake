
# 
# 用户应用安装
# 
FUNCTION(_dxm_builder_module_exe_copy_to_prebuilt)	

	set( CMAKE_INSTALL_PREFIX ${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt CACHE PATH "project install prefix" FORCE )
	_dxm_builder_module_exe_copy_to_prebuilt_impl()

ENDFUNCTION()

# 
# 用户库安装
# 
FUNCTION(_dxm_builder_module_lib_copy_to_prebuilt)

	set( CMAKE_INSTALL_PREFIX ${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt CACHE PATH "project install prefix" FORCE )
	_dxm_builder_module_lib_copy_to_prebuilt_impl()

ENDFUNCTION()

# 
# 拷贝到安装目录
# 
FUNCTION(_dxm_builder_module_copy_to_install)

	# 安装bin文件夹和symbols文件夹;
	IF(DXM_CMAKE_PLATFORM_WIN32 OR DXM_CMAKE_PLATFORM_WIN64)
		dxm_file_mkdir(${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/bin/${DXM_CMAKE_COMPILER}/debug)
		INSTALL(DIRECTORY ${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/bin/${DXM_CMAKE_COMPILER}/debug/
			CONFIGURATIONS debug
			DESTINATION ${DXM_CMAKE_INSTALL_DIRECTORY}/bin/${DXM_CMAKE_COMPILER}/debug
			PATTERN ".svn" EXCLUDE
			PATTERN "*"
		)
		dxm_file_mkdir(${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/bin/${DXM_CMAKE_COMPILER}/release)
		INSTALL(DIRECTORY ${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/bin/${DXM_CMAKE_COMPILER}/release/
			CONFIGURATIONS release
			DESTINATION ${DXM_CMAKE_INSTALL_DIRECTORY}/bin/${DXM_CMAKE_COMPILER}/release
			PATTERN ".svn" EXCLUDE
			PATTERN "*"
		)
		dxm_file_mkdir(${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/symbols/${DXM_CMAKE_COMPILER}/debug)
		INSTALL(DIRECTORY ${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/symbols/${DXM_CMAKE_COMPILER}/debug/
			CONFIGURATIONS debug
			DESTINATION ${DXM_CMAKE_INSTALL_DIRECTORY}/symbols/${DXM_CMAKE_COMPILER}/debug
			PATTERN ".svn" EXCLUDE
			PATTERN "*"
		)
		dxm_file_mkdir(${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/symbols/${DXM_CMAKE_COMPILER}/release)
		INSTALL(DIRECTORY ${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/symbols/${DXM_CMAKE_COMPILER}/release/
			CONFIGURATIONS release
			DESTINATION ${DXM_CMAKE_INSTALL_DIRECTORY}/symbols/${DXM_CMAKE_COMPILER}/release
			PATTERN ".svn" EXCLUDE
			PATTERN "*"
		)
	ELSEIF(DXM_CMAKE_PLATFORM_UNIX)	
		# dxm_file_mkdir(${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/bin/${DXM_CMAKE_COMPILER})
		# INSTALL(DIRECTORY ${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/bin/${DXM_CMAKE_COMPILER}/
		#	CONFIGURATIONS debug
		#	DESTINATION ${DXM_CMAKE_INSTALL_DIRECTORY}/bin/${DXM_CMAKE_COMPILER}
		#	PATTERN ".svn" EXCLUDE
		#	PATTERN "*"
		# )
	ELSEIF(DXM_CMAKE_PLATFORM_IOS)	
		dxm_file_mkdir(${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/bin/${DXM_CMAKE_COMPILER}/debug)
		INSTALL(DIRECTORY ${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/bin/${DXM_CMAKE_COMPILER}/debug/
			CONFIGURATIONS debug
			DESTINATION ${DXM_CMAKE_INSTALL_DIRECTORY}/bin/${DXM_CMAKE_COMPILER}/debug
			PATTERN ".svn" EXCLUDE
			PATTERN "*"
		)
		dxm_file_mkdir(${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/bin/${DXM_CMAKE_COMPILER}/release)
		INSTALL(DIRECTORY ${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/prebuilt/bin/${DXM_CMAKE_COMPILER}/release/
			CONFIGURATIONS release
			DESTINATION ${DXM_CMAKE_INSTALL_DIRECTORY}/bin/${DXM_CMAKE_COMPILER}/release
			PATTERN ".svn" EXCLUDE
			PATTERN "*"
		)	
	ENDIF()

ENDFUNCTION()

# 
# 拷贝到prebuilt
# 
FUNCTION(_dxm_builder_module_exe_copy_to_prebuilt_impl)	
	IF(DXM_CMAKE_PLATFORM_WIN32 OR DXM_CMAKE_PLATFORM_WIN64)	
		# 安装文件到目录
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS debug
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}/debug
		)	
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS release
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}/release
		)	

		# 打包符号文件和bin文件;
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS debug
			RUNTIME DESTINATION symbols/${DXM_CMAKE_COMPILER}/debug
		)		
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS release
			RUNTIME DESTINATION symbols/${DXM_CMAKE_COMPILER}/release
		)

		install(DIRECTORY ${EXECUTABLE_OUTPUT_PATH}/debug/
			CONFIGURATIONS debug
		 	DESTINATION symbols/${DXM_CMAKE_COMPILER}/debug
		 	FILES_MATCHING PATTERN "*.pdb")

		install(DIRECTORY ${EXECUTABLE_OUTPUT_PATH}/release/
			CONFIGURATIONS release
		 	DESTINATION symbols/${DXM_CMAKE_COMPILER}/release
		 	FILES_MATCHING PATTERN "*.pdb")

	ELSEIF(DXM_CMAKE_PLATFORM_UNIX)	
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}
			LIBRARY DESTINATION bin/${DXM_CMAKE_COMPILER}
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}
		)
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			RUNTIME DESTINATION ${DXM_CMAKE_INSTALL_DIRECTORY}/bin/${DXM_CMAKE_COMPILER}
			LIBRARY DESTINATION ${DXM_CMAKE_INSTALL_DIRECTORY}/bin/${DXM_CMAKE_COMPILER}
		)		
	ELSEIF(DXM_CMAKE_PLATFORM_IOS)	
		# 安装文件到目录
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS debug
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}/debug
			BUNDLE DESTINATION bin/${DXM_CMAKE_COMPILER}/debug
		)	
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS release
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}/release
			BUNDLE DESTINATION bin/${DXM_CMAKE_COMPILER}/release
		)
	ELSEIF(DXM_CMAKE_PLATFORM_ANDROID)	
		# 安装文件到目录
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}
			LIBRARY DESTINATION bin/${DXM_CMAKE_COMPILER}
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}
		)	
	ENDIF()

	IF(DXM_CMAKE_PLATFORM_WIN32 OR DXM_CMAKE_PLATFORM_WIN64)	
		# 方便调试拷贝 DXM_CMAKE_INSTALL_DIRECTORY_WIN32 的bin内容拷贝到运行目录;
		set(DEPENDENCIES_DLL_FILES ${DXM_CMAKE_INSTALL_DIRECTORY_WIN32}\\bin\\${DXM_CMAKE_COMPILER}\\"$(ConfigurationName)"\\*.dll)
		add_custom_command( TARGET ${DXM_BUILDER_MODULE}
			PRE_LINK 
			COMMAND if exist ${DEPENDENCIES_DLL_FILES} (copy ${DEPENDENCIES_DLL_FILES} output\\"$(ConfigurationName)"\\)
			)
			
		set(DEPENDENCIES_MANIFEST_FILES ${DXM_CMAKE_INSTALL_DIRECTORY_WIN32}\\bin\\${DXM_CMAKE_COMPILER}\\"$(ConfigurationName)"\\*.manifest)
		add_custom_command( TARGET ${DXM_BUILDER_MODULE}
			PRE_LINK 
			COMMAND if exist ${DEPENDENCIES_MANIFEST_FILES} (copy ${DEPENDENCIES_MANIFEST_FILES} output\\"$(ConfigurationName)"\\)
			)
		
		# 方便调试拷贝EXE相关的到 DXM_CMAKE_INSTALL_DIRECTORY_WIN32
		set(OUTPUT_EXE_FILES output\\"$(ConfigurationName)"\\*.exe)
		add_custom_command(TARGET ${DXM_BUILDER_MODULE}
			POST_BUILD 
			COMMAND if exist ${OUTPUT_EXE_FILES} (copy ${OUTPUT_EXE_FILES} ${DXM_CMAKE_INSTALL_DIRECTORY_WIN32}\\bin\\${DXM_CMAKE_COMPILER}\\"$(ConfigurationName)"\\)
			)
	ENDIF()
ENDFUNCTION()

# 
# 拷贝到prebuilt
# 
FUNCTION(_dxm_builder_module_lib_copy_to_prebuilt_impl)
	IF(DXM_CMAKE_PLATFORM_WIN32 OR DXM_CMAKE_PLATFORM_WIN64)	
		# 安装文件到目录
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS debug
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}/debug
			LIBRARY DESTINATION lib/${DXM_CMAKE_COMPILER}/debug
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}/debug
		)		
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS release
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}/release
			LIBRARY DESTINATION lib/${DXM_CMAKE_COMPILER}/release
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}/release
		)		

		# 打包符号文件和bin文件;
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS debug
			RUNTIME DESTINATION symbols/${DXM_CMAKE_COMPILER}/debug
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}/debug
		)		
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS release
			RUNTIME DESTINATION symbols/${DXM_CMAKE_COMPILER}/release
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}/release
		)

		install(DIRECTORY ${EXECUTABLE_OUTPUT_PATH}/debug/
			CONFIGURATIONS debug
		 	DESTINATION symbols/${DXM_CMAKE_COMPILER}/debug
		 	FILES_MATCHING PATTERN "*.pdb")

		install(DIRECTORY ${EXECUTABLE_OUTPUT_PATH}/release/
			CONFIGURATIONS release
		 	DESTINATION symbols/${DXM_CMAKE_COMPILER}/release
		 	FILES_MATCHING PATTERN "*.pdb")

	ELSEIF(DXM_CMAKE_PLATFORM_UNIX)	
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}
			LIBRARY DESTINATION lib/${DXM_CMAKE_COMPILER}
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}
		)	
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			RUNTIME DESTINATION ${DXM_CMAKE_INSTALL_DIRECTORY}/bin/${DXM_CMAKE_COMPILER}
			LIBRARY DESTINATION ${DXM_CMAKE_INSTALL_DIRECTORY}/bin/${DXM_CMAKE_COMPILER}
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}
		)		
	ELSEIF(DXM_CMAKE_PLATFORM_IOS)	
		# 安装文件到目录
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS debug
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}/debug
			LIBRARY DESTINATION lib/${DXM_CMAKE_COMPILER}/debug
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}/debug
		)		
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			CONFIGURATIONS release
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}/release
			LIBRARY DESTINATION lib/${DXM_CMAKE_COMPILER}/release
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}/release
		)	
	ELSEIF(DXM_CMAKE_PLATFORM_ANDROID)	
		# 安装文件到目录
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}
			LIBRARY DESTINATION bin/${DXM_CMAKE_COMPILER}
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}
		)	
		INSTALL(TARGETS ${DXM_BUILDER_MODULE}
			RUNTIME DESTINATION bin/${DXM_CMAKE_COMPILER}
			LIBRARY DESTINATION ${CMAKE_CURRENT_SOURCE_DIR}/src.android/java/libs/${ANDROID_NDK_ABI_NAME}
			ARCHIVE DESTINATION lib/${DXM_CMAKE_COMPILER}
		)			
	ENDIF()
	
	# 安装头文件	
	dxm_file_mkdir(${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/inc)
	INSTALL(DIRECTORY ${DXM_MODULE_${DXM_BUILDER_MODULE}_DIRECTORY}/inc/
		DESTINATION inc
		PATTERN ".svn" EXCLUDE
		PATTERN "*" PERMISSIONS OWNER_READ OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE
	)

	IF(DXM_CMAKE_PLATFORM_WIN32 OR DXM_CMAKE_PLATFORM_WIN64)		
		add_custom_command(TARGET ${DXM_BUILDER_MODULE}
			POST_BUILD 
			COMMAND echo %cd%
			)
		# 方便调试拷贝DLL相关的到 DXM_CMAKE_INSTALL_DIRECTORY_WIN32
		set(OUTPUT_DLL_FILES output\\"$(ConfigurationName)"\\*.dll)
		add_custom_command(TARGET ${DXM_BUILDER_MODULE}
			POST_BUILD 
			COMMAND if exist ${OUTPUT_DLL_FILES} (copy ${OUTPUT_DLL_FILES} ${DXM_CMAKE_INSTALL_DIRECTORY_WIN32}\\bin\\${DXM_CMAKE_COMPILER}\\"$(ConfigurationName)"\\)
			)
	ENDIF()
ENDFUNCTION()

